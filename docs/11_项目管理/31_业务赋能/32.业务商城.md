# 商城系统设计

## 数据库表设计

```sql
create table mall_order_details
(
    id                 bigint auto_increment
        primary key,
    unique_code        varchar(64)                            not null comment '唯一编码',
    order_code         varchar(64)                            not null comment '订单code',
    consignee_username varchar(64)                            not null comment '收货人姓名',
    consignee_phone    varchar(64)                            not null comment '收货人电话',
    consignee_postcode varchar(64)                            not null comment '收货地址-邮编',
    consignee_province varchar(64)                            not null comment '收货地址-省',
    consignee_city     varchar(64)                            not null comment '收货地址-市',
    consignee_area     varchar(64)                            not null comment '收货地址-区',
    consignee_address  varchar(256)                           not null comment '收货地址-详细地址',
    consignee_remark   varchar(256) default ''                null comment '收货地址-备注',
    logistics_code     varchar(64)  default ''                null comment '物流编号',
    logistics_company  varchar(64)  default ''                null comment '物流公司',
    create_by          bigint                                 null comment '创建人',
    create_time        datetime     default CURRENT_TIMESTAMP null comment '创建时间',
    update_by          bigint                                 null comment '更新人',
    update_time        datetime     default CURRENT_TIMESTAMP null comment '更新时间',
    deleted            int          default 0                 null comment '是否删除, 0未删除 1已删除'
) comment '订单明细表';

create table mall_orders
(
    id              bigint auto_increment
        primary key,
    unique_code     varchar(64)                        not null comment '订单号',
    order_price     decimal(10, 2)                     not null comment '订单金额',
    products_code   varchar(256)                       not null comment '商品code',
    products_number int      default 0                 null comment '商品数量',
    order_status    int      default 0                 null comment '订单状态, 0待支付 1待发货 2待收货 3待评价 4已完成 5已取消',
    create_by       bigint                             null comment '创建人',
    create_time     datetime default CURRENT_TIMESTAMP null comment '创建时间',
    update_by       bigint                             null comment '更新人',
    update_time     datetime default CURRENT_TIMESTAMP null comment '更新时间',
    deleted         int      default 0                 null comment '是否删除, 0未删除 1已删除'
) comment '订单表';

create table mall_products
(
    id            bigint auto_increment
        primary key,
    unique_code   varchar(64)                            not null comment '唯一编码',
    seller_code   varchar(64)                            not null comment '商家code',
    product_name  varchar(128)                           not null comment '商品名称',
    product_price decimal(10, 2)                         not null comment '商品价格',
    product_stock int                                    not null comment '商品库存',
    product_desc  varchar(256) default ''                null comment '商品描述',
    product_icon  varchar(256) default ''                null comment '商品图片',
    status        int          default 0                 null comment '商品状态, 0下架 1上架',
    create_by     bigint                                 null comment '创建人',
    create_time   datetime     default CURRENT_TIMESTAMP null comment '创建时间',
    update_by     bigint                                 null comment '更新人',
    update_time   datetime     default CURRENT_TIMESTAMP null comment '更新时间',
    deleted       int          default 0                 null comment '是否删除, 0未删除 1已删除'
) comment '商品表';

create table mall_products_categories
(
    id            bigint auto_increment
        primary key,
    unique_code   varchar(64)                            not null comment '唯一编码',
    category_name varchar(128)                           not null comment '分类名称',
    parent_code   varchar(64)  default '0'               null comment '父级编码',
    category_icon varchar(256) default ''                null comment '分类图标',
    category_desc varchar(256) default ''                null comment '分类描述',
    create_by     bigint                                 null comment '创建人',
    create_time   datetime     default CURRENT_TIMESTAMP null comment '创建时间',
    update_by     bigint                                 null comment '更新人',
    update_time   datetime     default CURRENT_TIMESTAMP null comment '更新时间',
    deleted       int          default 0                 null comment '是否删除, 0未删除 1已删除'
) comment '商品分类表';

create table mall_sellers
(
    id           bigint auto_increment
        primary key,
    unique_code  varchar(64)                        not null comment '唯一编码',
    seller_name  varchar(128)                       not null comment '商家名称',
    seller_phone varchar(32)                        not null comment '商家电话',
    mark         varchar(256)                       null comment '商家备注',
    create_by    bigint                             null comment '创建人',
    create_time  datetime default CURRENT_TIMESTAMP null comment '创建时间',
    update_by    bigint                             null comment '更新人',
    update_time  datetime default CURRENT_TIMESTAMP null comment '更新时间',
    deleted      int      default 0                 null comment '是否删除, 0未删除 1已删除'
) comment '商家表';

create table mall_shopping_carts
(
    id           bigint auto_increment
        primary key,
    unique_code  varchar(64)                        not null comment '唯一编码',
    user_code    varchar(64)                        not null comment '用户ID',
    product_code varchar(128)                       not null comment '商品ID',
    quantity     int      default 1                 null comment '数量',
    create_by    bigint                             null comment '创建人',
    create_time  datetime default CURRENT_TIMESTAMP null comment '创建时间',
    update_by    bigint                             null comment '更新人',
    update_time  datetime default CURRENT_TIMESTAMP null comment '更新时间',
    deleted      int      default 0                 null comment '是否删除, 0未删除 1已删除'
) comment '购物车表';

create table mall_user_addresses
(
    id                 bigint auto_increment
        primary key,
    unique_code        varchar(64)                            not null comment '唯一编码',
    consignee_username varchar(64)                            not null comment '收货人姓名',
    consignee_phone    varchar(64)                            not null comment '收货人电话',
    consignee_postcode varchar(64)                            not null comment '收货地址-邮编',
    consignee_province varchar(64)                            not null comment '收货地址-省',
    consignee_city     varchar(64)                            not null comment '收货地址-市',
    consignee_area     varchar(64)                            not null comment '收货地址-区',
    consignee_address  varchar(256)                           not null comment '收货地址-详细地址',
    consignee_remark   varchar(256) default ''                null comment '收货地址-备注',
    is_default         int          default 0                 null comment '是否默认, 0否 1是',
    create_by          bigint                                 null comment '创建人',
    create_time        datetime     default CURRENT_TIMESTAMP null comment '创建时间',
    update_by          bigint                                 null comment '更新人',
    update_time        datetime     default CURRENT_TIMESTAMP null comment '更新时间',
    deleted            int          default 0                 null comment '是否删除, 0未删除 1已删除'
) comment '收货地址管理';
```

```mermaid
erDiagram
    mall_order_details["mall_order_details【订单详情表】"] {
        bigint id PK "唯一标识符"
        varchar unique_code "订单明细唯一编码"
        varchar order_code "订单编号"
        varchar consignee_username "收货人姓名"
        varchar consignee_phone "收货人电话"
        varchar consignee_postcode "收货地址-邮编"
        varchar consignee_province "收货地址-省"
        varchar consignee_city "收货地址-市"
        varchar consignee_area "收货地址-区"
        varchar consignee_address "收货地址-详细地址"
        varchar consignee_remark "收货地址-备注"
        varchar logistics_code "物流编号"
        varchar logistics_company "物流公司"
    }
    mall_orders["mall_orders【订单表】"] {
        bigint id PK "唯一标识符"
        varchar unique_code "订单号"
        decimal order_price "订单金额"
        varchar products_code "商品code"
        int products_number "商品数量"
        int order_status "订单状态"
    }
    mall_user_addresses["mall_user_addresses【收货地址管理】"] {
        varchar user_code PK "用户ID"
        varchar address_name "地址名称"
        varchar consignee_name "收货人姓名"
        varchar consignee_phone "收货人电话"
        varchar postcode "邮编"
        varchar province "省"
        varchar city "市"
        varchar area "区"
        varchar detailed_address "详细地址"
        varchar remark "备注"
        boolean is_default "是否默认地址"
    }
    mall_shopping_carts["mall_shopping_carts【购物车表】"] {
        varchar unique_code PK "唯一标识符"
        varchar user_code "用户ID"
        varchar product_code "商品code"
        int quantity "数量"
    }
    mall_product_approval["mall_product_approval【产品审批表】"] {
        bigint id PK "唯一标识符"
        varchar product_code "商品code"
        int approval_status "审批状态: 0-待审批, 1-已通过, 2-未通过"
        varchar approver "审批人"
        timestamp approved_at "审批时间"
        varchar reason "审批原因"
    }
    mall_products["mall_products【产品表】"] {
        bigint id PK "唯一标识符"
        varchar unique_code "唯一编码"
        varchar seller_code "商家code"
        varchar product_name "商品名称"
        decimal product_price "商品价格"
        int product_stock "商品库存"
        varchar product_desc "商品描述"
        varchar product_icon "商品图片"
        int status "商品状态: 0-下架, 1-上架"
    }
    mall_products_categories["mall_products_categories【商品分类表】"] {
        bigint id PK "唯一标识符"
        varchar unique_code "唯一编码"
        varchar category_name "分类名称"
        varchar parent_code "父级编码"
        varchar category_icon "分类图标"
        varchar category_desc "分类描述"
    }
    mall_sellers["mall_sellers【商家表】"] {
        bigint id PK "唯一标识符"
        varchar unique_code "唯一编码"
        varchar seller_name "商家名称"
        varchar seller_phone "商家电话"
        varchar mark "商家备注"
    }

    mall_orders ||--o{ mall_order_details: "包含"
    mall_products ||--|{ mall_orders: "属于"
    mall_products_categories ||--|{ mall_products: "分类"
    mall_sellers ||--|{ mall_products: "提供"
    mall_shopping_carts ||--|{ mall_products: "包含"
    mall_user_addresses ||--|{ mall_order_details: "关联"
    mall_product_approval ||--|{ mall_products : "审批"
```

## 整体业务流程图

```mermaid
flowchart TD
    subgraph 用户模块
        A1[用户注册] --> A2[用户登录]
        A2 --> A3[用户中心]
        A3 --> A4[查看订单历史]
        A3 --> A5[管理收货地址]
    end
    subgraph 商品模块
        A2 --> B1[浏览商品分类]
        B1 --> B2[搜索商品]
        B2 --> B3[商品详情页]
        B3 --> B4[加入购物车]
        B3 --> B5[收藏商品]
    end
    subgraph 购物车模块
        B4 --> C1[查看购物车]
        C1 --> C2[修改购物车商品数量]
        C2 --> C3[提交订单]
    end
    subgraph 订单模块
        C3 --> D1[填写订单信息]
        D1 --> D2[选择配送方式]
        D2 --> D3[确认订单]
        D3 --> D4[生成订单]
        D4 --> D5[订单付款]
    end
    subgraph 支付模块
        D5 --> E1[选择支付方式]
        E1 --> E2[支付成功]
        E2 --> E3[支付失败处理]
    end
    subgraph 配送模块
        D4 --> F1[订单分拣]
        F1 --> F2[订单配送]
        F2 --> F3[订单签收]
    end
    subgraph 售后模块
        F3 --> G1[申请售后]
        G1 --> G2[退换货处理]
        G2 --> G3[售后完成]
    end

```
