import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as a,f as e}from"./app-efa5e96e.js";const t={},l=e(`<h2 id="pacemakerä»‹ç»" tabindex="-1"><a class="header-anchor" href="#pacemakerä»‹ç»" aria-hidden="true">#</a> Pacemakerä»‹ç»</h2><blockquote><p>Pacemaker æ˜¯ä¸€ä¸ªå¼€æºçš„é«˜å¯ç”¨æ€§è½¯ä»¶ï¼Œç”¨äºåœ¨é›†ç¾¤ç¯å¢ƒä¸­ç®¡ç†å’Œç›‘æ§æœåŠ¡çš„å¯ç”¨æ€§ã€‚æ—¨åœ¨æä¾›ä¸€å¥—æ¡†æ¶å’Œå·¥å…·ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ„å»ºé«˜å¯ç”¨æ€§çš„æœåŠ¡ã€‚</p><p>ä¸»è¦ç”¨äºæ„å»ºé«˜å¯ç”¨æ€§çš„é›†ç¾¤æœåŠ¡ï¼Œç¡®ä¿åœ¨èŠ‚ç‚¹æˆ–æœåŠ¡å‡ºç°æ•…éšœæ—¶èƒ½å¤Ÿä¿æŒç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚å®ƒè¢«å¹¿æ³›åº”ç”¨äºä¼ä¸šç¯å¢ƒä¸­çš„å…³é”®ä¸šåŠ¡åº”ç”¨å’ŒæœåŠ¡ï¼Œå¦‚æ•°æ®åº“ã€Web æœåŠ¡å™¨ã€åº”ç”¨æœåŠ¡å™¨ç­‰ã€‚</p></blockquote><h3 id="ä¸»è¦ç‰¹ç‚¹å’ŒåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#ä¸»è¦ç‰¹ç‚¹å’ŒåŠŸèƒ½" aria-hidden="true">#</a> ä¸»è¦ç‰¹ç‚¹å’ŒåŠŸèƒ½</h3><ol><li><p>é›†ç¾¤ç®¡ç†ï¼š Pacemaker å…è®¸å°†å¤šä¸ªèŠ‚ç‚¹ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œè¿™äº›èŠ‚ç‚¹å¯ä»¥å…±åŒå·¥ä½œä»¥æä¾›æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚é›†ç¾¤ä¸­çš„èŠ‚ç‚¹é€šè¿‡ç½‘ç»œé€šä¿¡ååŒå·¥ä½œã€‚</p></li><li><p>èµ„æºç®¡ç†ï¼š Pacemaker å¯ä»¥ç®¡ç†å’Œç›‘æ§é›†ç¾¤ä¸­çš„å„ç§èµ„æºï¼Œå¦‚ IP åœ°å€ã€è™šæ‹Ÿ IP åœ°å€ã€æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ç­‰ã€‚å®ƒèƒ½å¤Ÿå¯åŠ¨ã€åœæ­¢å’Œè¿ç§»è¿™äº›èµ„æºï¼Œä»¥ç¡®ä¿å®ƒä»¬åœ¨æ•´ä¸ªé›†ç¾¤ä¸­ä¿æŒå¯ç”¨çŠ¶æ€ã€‚</p></li><li><p>æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ¢å¤ï¼š Pacemaker æä¾›äº†æ•…éšœæ£€æµ‹æœºåˆ¶ï¼Œèƒ½å¤Ÿæ£€æµ‹èŠ‚ç‚¹å’Œèµ„æºçš„æ•…éšœã€‚ä¸€æ—¦å‘ç°æ•…éšœï¼Œå®ƒå¯ä»¥è‡ªåŠ¨é‡‡å–æªæ–½æ¥æ¢å¤æœåŠ¡ï¼Œä¾‹å¦‚è¿ç§»èµ„æºåˆ°å…¶ä»–å¥åº·çš„èŠ‚ç‚¹ã€‚</p></li><li><p>çµæ´»çš„èµ„æºç­–ç•¥ï¼š Pacemaker å…è®¸ç”¨æˆ·å®šä¹‰èµ„æºçš„å¯åŠ¨é¡ºåºã€äº²å’Œæ€§è§„åˆ™å’Œæ”¾ç½®çº¦æŸï¼Œä»¥ç¡®ä¿æœåŠ¡åœ¨ç‰¹å®šèŠ‚ç‚¹ä¸Šä»¥æœŸæœ›çš„æ–¹å¼è¿è¡Œã€‚</p></li><li><p>å¼ºå¤§çš„æ’ä»¶æ¶æ„ï¼š Pacemaker çš„æ’ä»¶æ¶æ„å…è®¸ç”¨æˆ·é›†æˆä¸åŒç±»å‹çš„èµ„æºä»£ç†ï¼Œä»¥æ”¯æŒå„ç§æœåŠ¡å’Œåº”ç”¨ç¨‹åºã€‚å®ƒæ”¯æŒå¤šç§èµ„æºä»£ç†ï¼Œå¦‚ OCFï¼ˆOpen Cluster Frameworkï¼‰èµ„æºä»£ç†ã€Systemd æœåŠ¡èµ„æºä»£ç†ç­‰ã€‚</p></li><li><p>Web ç•Œé¢å’Œå‘½ä»¤è¡Œå·¥å…·ï¼š Pacemaker æä¾›äº†ç›´è§‚çš„ Web ç•Œé¢ï¼ˆPacemaker GUIï¼‰å’Œå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºé…ç½®ã€ç›‘æ§å’Œç®¡ç†é›†ç¾¤ã€‚</p></li><li><p>å¯æ‰©å±•æ€§å’Œå…¼å®¹æ€§ï¼š Pacemaker æ˜¯ä¸€ä¸ªå¯æ‰©å±•å’Œé«˜åº¦æ¨¡å—åŒ–çš„ç³»ç»Ÿï¼Œå¯ä»¥é€‚åº”ä¸åŒè§„æ¨¡å’Œç±»å‹çš„é›†ç¾¤ã€‚å®ƒä¸å„ç§å­˜å‚¨ç³»ç»Ÿã€ç½‘ç»œé…ç½®å’Œç¡¬ä»¶å…¼å®¹ï¼Œå¹¶æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿã€‚</p></li></ol><h2 id="å‘½ä»¤ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤ä»‹ç»" aria-hidden="true">#</a> å‘½ä»¤ä»‹ç»</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åœ¨åŸºäº Red Hat çš„ç³»ç»Ÿä¸Š</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> pacemaker corosync pcs
<span class="token comment"># åœ¨åŸºäº Debian çš„ç³»ç»Ÿä¸Š</span>
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> pacemaker corosync pcs

<span class="token comment">## é…ç½®æ–‡ä»¶ï¼š/etc/corosync/corosync.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ›å»ºé›†ç¾¤å’ŒèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºé›†ç¾¤å’ŒèŠ‚ç‚¹" aria-hidden="true">#</a> åˆ›å»ºé›†ç¾¤å’ŒèŠ‚ç‚¹</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åˆ›å»ºé›†ç¾¤</span>
<span class="token function">sudo</span> pcs cluster setup <span class="token parameter variable">--name</span> mycluster node1 node2
<span class="token comment"># å¯åŠ¨é›†ç¾¤</span>
<span class="token function">sudo</span> pcs cluster start <span class="token parameter variable">--all</span>
<span class="token comment"># åœæ­¢é›†ç¾¤</span>
<span class="token function">sudo</span> pcs cluster stop <span class="token parameter variable">--all</span>
<span class="token comment"># é‡å¯é›†ç¾¤</span>
<span class="token function">sudo</span> pcs cluster restart <span class="token parameter variable">--all</span>
<span class="token comment"># æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span>
<span class="token function">sudo</span> pcs status

<span class="token comment">## æ·»åŠ èŠ‚ç‚¹åˆ°é›†ç¾¤ï¼šå°†æ–°èŠ‚ç‚¹ new_node æ·»åŠ åˆ°ç°æœ‰çš„ Pacemaker é›†ç¾¤ã€‚</span>
<span class="token function">sudo</span> pcs cluster <span class="token function">node</span> <span class="token function">add</span> new_node
<span class="token comment">## åˆ é™¤èŠ‚ç‚¹ä»é›†ç¾¤ï¼šä» Pacemaker é›†ç¾¤ä¸­åˆ é™¤èŠ‚ç‚¹ node_to_removeã€‚</span>
<span class="token function">sudo</span> pcs cluster <span class="token function">node</span> remove node_to_remove
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯ç®¡ç†çš„èµ„æº" tabindex="-1"><a class="header-anchor" href="#å¯ç®¡ç†çš„èµ„æº" aria-hidden="true">#</a> å¯ç®¡ç†çš„èµ„æº</h3><ul><li>IP åœ°å€èµ„æº</li></ul><blockquote><p>å…è®¸ç®¡ç†è™šæ‹Ÿ IP åœ°å€ï¼Œç¡®ä¿åœ¨æ•…éšœåˆ‡æ¢æ—¶ IP åœ°å€èƒ½å¤Ÿåœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´è¿ç§»ã€‚</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> pcs resource create myvip ocf:heartbeat:IPaddr2 <span class="token assign-left variable">ip</span><span class="token operator">=</span><span class="token number">192.168</span>.1.100 <span class="token assign-left variable">cidr_netmask</span><span class="token operator">=</span><span class="token number">24</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>æ–‡ä»¶ç³»ç»Ÿèµ„æº (ocfğŸ’“Filesystem)</li></ul><blockquote><p>å…è®¸ç®¡ç†æ–‡ä»¶ç³»ç»Ÿï¼Œç¡®ä¿åœ¨èŠ‚ç‚¹åˆ‡æ¢æ—¶æŒ‚è½½å’Œå¸è½½æ–‡ä»¶ç³»ç»Ÿã€‚</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> pcs resource create myfs ocf:heartbeat:Filesystem <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token string">&quot;/dev/sdb1&quot;</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">&quot;/mnt/data&quot;</span> <span class="token assign-left variable">fstype</span><span class="token operator">=</span><span class="token string">&quot;ext4&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>æœåŠ¡èµ„æº (systemd)</li></ul><blockquote><p>å…è®¸ç®¡ç† Systemd æœåŠ¡ï¼Œç¡®ä¿åœ¨èŠ‚ç‚¹åˆ‡æ¢æ—¶å¯åŠ¨å’Œåœæ­¢æœåŠ¡ã€‚</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> pcs resource create myservice systemd:apache2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>æ•°æ®åº“èµ„æº (ocfğŸ’“pgsql)</li></ul><blockquote><p>å…è®¸ç®¡ç† PostgreSQL æ•°æ®åº“å®ä¾‹ï¼Œç¡®ä¿åœ¨èŠ‚ç‚¹åˆ‡æ¢æ—¶å¯åŠ¨å’Œåœæ­¢æ•°æ®åº“æœåŠ¡ã€‚</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> pcs resource create mydb ocf:heartbeat:pgsql <span class="token punctuation">\\</span>
  <span class="token function">op</span> monitor <span class="token assign-left variable">interval</span><span class="token operator">=</span>30s <span class="token punctuation">\\</span>
  params <span class="token assign-left variable">pgctl</span><span class="token operator">=</span><span class="token string">&quot;/usr/pgsql-13/bin/pg_ctl&quot;</span> <span class="token punctuation">\\</span>
  params <span class="token assign-left variable">pgdata</span><span class="token operator">=</span><span class="token string">&quot;/var/lib/pgsql/13/data&quot;</span> <span class="token punctuation">\\</span>
  params <span class="token assign-left variable">pgport</span><span class="token operator">=</span><span class="token string">&quot;5432&quot;</span> <span class="token punctuation">\\</span>
  params <span class="token assign-left variable">pgdatabase</span><span class="token operator">=</span><span class="token string">&quot;mydatabase&quot;</span> <span class="token punctuation">\\</span>
  params <span class="token assign-left variable">pgsuperuser</span><span class="token operator">=</span><span class="token string">&quot;postgres&quot;</span> <span class="token punctuation">\\</span>
  params <span class="token assign-left variable">pgdaemon</span><span class="token operator">=</span><span class="token string">&quot;postgres&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>è™šæ‹Ÿæœºèµ„æº (ocfğŸ’“VirtualDomain)ï¼š</li></ul><blockquote><p>å…è®¸ç®¡ç†è™šæ‹Ÿæœºï¼Œç¡®ä¿åœ¨èŠ‚ç‚¹åˆ‡æ¢æ—¶å¯åŠ¨å’Œåœæ­¢è™šæ‹Ÿæœºã€‚</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> pcs resource create myvm ocf:heartbeat:VirtualDomain <span class="token assign-left variable">hypervisor</span><span class="token operator">=</span><span class="token string">&quot;qemu&quot;</span> <span class="token punctuation">\\</span>
  <span class="token assign-left variable">config</span><span class="token operator">=</span><span class="token string">&quot;/path/to/vm.xml&quot;</span> <span class="token punctuation">\\</span>
  <span class="token assign-left variable">migration_transport</span><span class="token operator">=</span><span class="token string">&quot;ssh&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è¿ç»´å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#è¿ç»´å‘½ä»¤" aria-hidden="true">#</a> è¿ç»´å‘½ä»¤</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹èµ„æºé…ç½®</span>
<span class="token function">sudo</span> pcs resource show
<span class="token comment"># åˆ é™¤èµ„æº</span>
<span class="token function">sudo</span> pcs resource delete myvip
<span class="token comment"># åˆ é™¤çº¦æŸ</span>
<span class="token function">sudo</span> pcs constraint delete <span class="token operator">&lt;</span>constraint_id<span class="token operator">&gt;</span>

<span class="token comment"># é…ç½®çº¦æŸï¼šè®¾ç½®èµ„æºå¯åŠ¨é¡ºåºçº¦æŸ</span>
<span class="token function">sudo</span> pcs constraint order start myvip <span class="token keyword">then</span> myservice
<span class="token comment"># æŸ¥çœ‹çº¦æŸé…ç½®</span>
<span class="token function">sudo</span> pcs constraint show

<span class="token comment">## è®¾ç½®å±æ€§ï¼šè®¾ç½® Pacemaker å±æ€§ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œç¦ç”¨ STONITHï¼ˆShoot The Other Node In The Headï¼‰ã€‚</span>
<span class="token function">sudo</span> pcs property <span class="token builtin class-name">set</span> stonith-enabled<span class="token operator">=</span>false
<span class="token comment">## æŸ¥çœ‹å±æ€§é…ç½®ï¼šæŸ¥çœ‹å½“å‰é…ç½®çš„ Pacemaker å±æ€§åˆ—è¡¨ã€‚</span>
<span class="token function">sudo</span> pcs property show
<span class="token comment">## å¯ç”¨/ç¦ç”¨èŠ‚ç‚¹ï¼šä½¿èŠ‚ç‚¹è¿›å…¥æˆ–é€€å‡º Standby æ¨¡å¼ã€‚åœ¨ Standby æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹ä¸å‚ä¸èµ„æºç®¡ç†ã€‚</span>
<span class="token function">sudo</span> pcs cluster standby node_to_standby
<span class="token function">sudo</span> pcs cluster unstandby node_to_unstandby
<span class="token comment">## å¼ºåˆ¶å¯åŠ¨èµ„æºï¼šå¼ºåˆ¶å¯åŠ¨åä¸º myresource çš„èµ„æºï¼Œå³ä½¿æœ‰å…¶ä»–çº¦æŸé˜»æ­¢ã€‚</span>
<span class="token function">sudo</span> pcs resource <span class="token builtin class-name">enable</span> myresource
<span class="token comment">## å¼ºåˆ¶åœæ­¢èµ„æºï¼š</span>
<span class="token function">sudo</span> pcs resource disable myresource
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,26),i=[l];function c(o,p){return n(),a("div",null,i)}const u=s(t,[["render",c],["__file","10.é›†ç¾¤ç®¡ç†-Pacemaker.html.vue"]]);export{u as default};
