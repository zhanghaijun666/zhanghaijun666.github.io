import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as i,c as u,a as n,b as s,d as a,e as r,w as e,f as o}from"./app-efa5e96e.js";const k={},d=n("p",null,"Springboot-æ³¨è§£-é€šç”¨æ“ä½œæ—¥å¿—ç»„ä»¶",-1),v=n("p",null,"æ­¤ç»„ä»¶è§£å†³çš„é—®é¢˜æ˜¯ï¼š ã€Œè°ã€åœ¨ã€Œä»€ä¹ˆæ—¶é—´ã€å¯¹ã€Œä»€ä¹ˆã€åšäº†ã€Œä»€ä¹ˆäº‹ã€",-1),m={href:"https://github.com/mouzt/mzt-biz-log",target:"_blank",rel:"noopener noreferrer"},b={class:"table-of-contents"},g=o(`<h2 id="maven-ä¾èµ–æ·»åŠ -sdk-ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#maven-ä¾èµ–æ·»åŠ -sdk-ä¾èµ–" aria-hidden="true">#</a> maven ä¾èµ–æ·»åŠ  SDK ä¾èµ–</h2><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.github.mouzt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>bizlog-sdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ·»åŠ -enablelogrecord-æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ -enablelogrecord-æ³¨è§£" aria-hidden="true">#</a> æ·»åŠ  @EnableLogRecord æ³¨è§£</h2><p>tenant æ˜¯ä»£è¡¨ç§Ÿæˆ·çš„æ ‡è¯†ï¼Œä¸€èˆ¬ä¸€ä¸ªæœåŠ¡æˆ–è€…ä¸€ä¸ªä¸šåŠ¡ä¸‹çš„å¤šä¸ªæœåŠ¡éƒ½å†™æ­»ä¸€ä¸ª tenant å°±å¯ä»¥</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>
<span class="token annotation punctuation">@EnableLogRecord</span><span class="token punctuation">(</span>tenant <span class="token operator">=</span> <span class="token string">&quot;com.mzt.test&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Main</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ—¥å¿—åŸ‹ç‚¹" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—åŸ‹ç‚¹" aria-hidden="true">#</a> æ—¥å¿—åŸ‹ç‚¹</h2><h3 id="_1-æ™®é€šçš„è®°å½•æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#_1-æ™®é€šçš„è®°å½•æ—¥å¿—" aria-hidden="true">#</a> 1. æ™®é€šçš„è®°å½•æ—¥å¿—</h3>`,7),f=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{java:"",class:"language-java"},[n("code",null,[n("span",{class:"token comment"},`/*
* pefixï¼šæ˜¯æ‹¼æ¥åœ¨ bizNo ä¸Šä½œä¸º log çš„ä¸€ä¸ªæ ‡è¯†ã€‚é¿å… bizNo éƒ½ä¸ºæ•´æ•° ID çš„æ—¶å€™å’Œå…¶ä»–çš„ä¸šåŠ¡ä¸­çš„ ID é‡å¤ã€‚æ¯”å¦‚è®¢å• IDã€ç”¨æˆ· ID ç­‰
* bizNoï¼šå°±æ˜¯ä¸šåŠ¡çš„ IDï¼Œæ¯”å¦‚è®¢å•IDï¼Œæˆ‘ä»¬æŸ¥è¯¢çš„æ—¶å€™å¯ä»¥æ ¹æ® bizNo æŸ¥è¯¢å’Œå®ƒç›¸å…³çš„æ“ä½œæ—¥å¿—
* successï¼šæ–¹æ³•è°ƒç”¨æˆåŠŸåæŠŠ success è®°å½•åœ¨æ—¥å¿—çš„å†…å®¹ä¸­
*
* SpEL è¡¨è¾¾å¼ï¼šå…¶ä¸­ç”¨åŒå¤§æ‹¬å·åŒ…å›´èµ·æ¥çš„ï¼ˆä¾‹å¦‚ï¼š{{#order.purchaseName}}ï¼‰#order.purchaseName æ˜¯ SpELè¡¨è¾¾å¼ã€‚Springä¸­æ”¯æŒçš„å®ƒéƒ½æ”¯æŒçš„ã€‚
*/`),s(`
`),n("span",{class:"token annotation punctuation"},"@LogRecordAnnotation"),n("span",{class:"token punctuation"},"("),s(`
    success `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.purchaseName}}ä¸‹äº†ä¸€ä¸ªè®¢å•,è´­ä¹°å•†å“ã€Œ{{#order.productName}}ã€,ä¸‹å•ç»“æœ:{{#_ret}}"'),n("span",{class:"token punctuation"},","),s(`
    prefix `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"LogRecordType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"ORDER"),n("span",{class:"token punctuation"},","),s(`
    bizNo `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.orderNo}}"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"boolean"),s(),n("span",{class:"token function"},"createOrder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Order"),s(" order"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ã€åˆ›å»ºè®¢å•ã€‘orderNo={}"'),n("span",{class:"token punctuation"},","),s(" order"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getOrderNo"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// db insert order"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`),n("span",{class:"token comment"},'// æ­¤æ—¶ä¼šæ‰“å°æ“ä½œæ—¥å¿— "å¼ ä¸‰ä¸‹äº†ä¸€ä¸ªè®¢å•,è´­ä¹°å•†å“ã€Œè¶…å€¼ä¼˜æƒ çº¢çƒ§è‚‰å¥—é¤ã€,ä¸‹å•ç»“æœ:true"'),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),h=n("h3",{id:"_2-æœŸæœ›è®°å½•å¤±è´¥çš„æ—¥å¿—-å¦‚æœæŠ›å‡ºå¼‚å¸¸åˆ™è®°å½•-fail-çš„æ—¥å¿—-æ²¡æœ‰æŠ›å‡ºè®°å½•-success-çš„æ—¥å¿—",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-æœŸæœ›è®°å½•å¤±è´¥çš„æ—¥å¿—-å¦‚æœæŠ›å‡ºå¼‚å¸¸åˆ™è®°å½•-fail-çš„æ—¥å¿—-æ²¡æœ‰æŠ›å‡ºè®°å½•-success-çš„æ—¥å¿—","aria-hidden":"true"},"#"),s(" 2. æœŸæœ›è®°å½•å¤±è´¥çš„æ—¥å¿—, å¦‚æœæŠ›å‡ºå¼‚å¸¸åˆ™è®°å½• fail çš„æ—¥å¿—ï¼Œæ²¡æœ‰æŠ›å‡ºè®°å½• success çš„æ—¥å¿—")],-1),y=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{java:"",class:"language-java"},[n("code",null,[n("span",{class:"token comment"},"// å…¶ä¸­çš„ #_errorMsg æ˜¯å–çš„æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åçš„å¼‚å¸¸çš„ errorMessageã€‚"),s(`
`),n("span",{class:"token annotation punctuation"},"@LogRecordAnnotation"),n("span",{class:"token punctuation"},"("),s(`
    fail `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"åˆ›å»ºè®¢å•å¤±è´¥ï¼Œå¤±è´¥åŸå› ï¼šã€Œ{{#_errorMsg}}ã€"'),n("span",{class:"token punctuation"},","),s(`
    success `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.purchaseName}}ä¸‹äº†ä¸€ä¸ªè®¢å•,è´­ä¹°å•†å“ã€Œ{{#order.productName}}ã€,ä¸‹å•ç»“æœ:{{#_ret}}"'),n("span",{class:"token punctuation"},","),s(`
    prefix `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"LogRecordType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"ORDER"),n("span",{class:"token punctuation"},","),s(`
    bizNo `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.orderNo}}"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"boolean"),s(),n("span",{class:"token function"},"createOrder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Order"),s(" order"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ã€åˆ›å»ºè®¢å•ã€‘orderNo={}"'),n("span",{class:"token punctuation"},","),s(" order"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getOrderNo"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// db insert order"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_=n("h3",{id:"_3-æ—¥å¿—æ”¯æŒç§ç±»",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_3-æ—¥å¿—æ”¯æŒç§ç±»","aria-hidden":"true"},"#"),s(" 3. æ—¥å¿—æ”¯æŒç§ç±»")],-1),w=n("p",null,"å¯¹æ—¥å¿—åšåˆ†ç±»ï¼ŒæŸ¥è¯¢æ–¹ä¾¿ï¼Œæ”¯æŒæ›´å¤šçš„ä¸šåŠ¡ã€‚",-1),R=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{java:"",class:"language-java"},[n("code",null,[n("span",{class:"token annotation punctuation"},"@LogRecordAnnotation"),n("span",{class:"token punctuation"},"("),s(`
    fail `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"åˆ›å»ºè®¢å•å¤±è´¥ï¼Œå¤±è´¥åŸå› ï¼šã€Œ{{#_errorMsg}}ã€"'),n("span",{class:"token punctuation"},","),s(`
    category `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"MANAGER"'),n("span",{class:"token punctuation"},","),s(`
    success `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.purchaseName}}ä¸‹äº†ä¸€ä¸ªè®¢å•,è´­ä¹°å•†å“ã€Œ{{#order.productName}}ã€,ä¸‹å•ç»“æœ:{{#_ret}}"'),n("span",{class:"token punctuation"},","),s(`
    prefix `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"LogRecordType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"ORDER"),n("span",{class:"token punctuation"},","),s(`
    bizNo `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.orderNo}}"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"boolean"),s(),n("span",{class:"token function"},"createOrder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Order"),s(" order"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ã€åˆ›å»ºè®¢å•ã€‘orderNo={}"'),n("span",{class:"token punctuation"},","),s(" order"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getOrderNo"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// db insert order"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),O=n("h3",{id:"_4-æ”¯æŒè®°å½•æ“ä½œçš„è¯¦æƒ…æˆ–è€…é¢å¤–ä¿¡æ¯",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_4-æ”¯æŒè®°å½•æ“ä½œçš„è¯¦æƒ…æˆ–è€…é¢å¤–ä¿¡æ¯","aria-hidden":"true"},"#"),s(" 4. æ”¯æŒè®°å½•æ“ä½œçš„è¯¦æƒ…æˆ–è€…é¢å¤–ä¿¡æ¯")],-1),S=n("p",null,"å¦‚æœä¸€ä¸ªæ“ä½œä¿®æ”¹äº†å¾ˆå¤šå­—æ®µï¼Œä½†æ˜¯ success çš„æ—¥å¿—æ¨¡ç‰ˆé‡Œé¢é˜²æ­¢è¿‡é•¿ä¸èƒ½æŠŠä¿®æ”¹è¯¦æƒ…å…¨éƒ¨å±•ç¤ºå‡ºæ¥ï¼Œè¿™æ—¶å€™éœ€è¦æŠŠä¿®æ”¹çš„è¯¦æƒ…ä¿å­˜åˆ° detail å­—æ®µï¼Œ detail æ˜¯ä¸€ä¸ª String ï¼Œéœ€è¦è‡ªå·±åºåˆ—åŒ–ã€‚",-1),I=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{java:"",class:"language-java"},[n("code",null,[n("span",{class:"token annotation punctuation"},"@LogRecordAnnotation"),n("span",{class:"token punctuation"},"("),s(`
    fail `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"åˆ›å»ºè®¢å•å¤±è´¥ï¼Œå¤±è´¥åŸå› ï¼šã€Œ{{#_errorMsg}}ã€"'),n("span",{class:"token punctuation"},","),s(`
    category `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"MANAGER_VIEW"'),n("span",{class:"token punctuation"},","),s(`
    detail `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.toString()}}"'),n("span",{class:"token punctuation"},","),s(`
    success `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.purchaseName}}ä¸‹äº†ä¸€ä¸ªè®¢å•,è´­ä¹°å•†å“ã€Œ{{#order.productName}}ã€,ä¸‹å•ç»“æœ:{{#_ret}}"'),n("span",{class:"token punctuation"},","),s(`
    prefix `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"LogRecordType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"ORDER"),n("span",{class:"token punctuation"},","),s(`
    bizNo `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.orderNo}}"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"boolean"),s(),n("span",{class:"token function"},"createOrder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Order"),s(" order"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ã€åˆ›å»ºè®¢å•ã€‘orderNo={}"'),n("span",{class:"token punctuation"},","),s(" order"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getOrderNo"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// db insert order"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),L=n("h3",{id:"_5-å¦‚ä½•æŒ‡å®šæ“ä½œæ—¥å¿—çš„æ“ä½œäººæ˜¯ä»€ä¹ˆ-æ¡†æ¶æä¾›äº†ä¸¤ç§æ–¹æ³•",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_5-å¦‚ä½•æŒ‡å®šæ“ä½œæ—¥å¿—çš„æ“ä½œäººæ˜¯ä»€ä¹ˆ-æ¡†æ¶æä¾›äº†ä¸¤ç§æ–¹æ³•","aria-hidden":"true"},"#"),s(" 5. å¦‚ä½•æŒ‡å®šæ“ä½œæ—¥å¿—çš„æ“ä½œäººæ˜¯ä»€ä¹ˆï¼Ÿæ¡†æ¶æä¾›äº†ä¸¤ç§æ–¹æ³•")],-1),N=n("p",null,"ç¬¬ä¸€ç§ï¼šæ‰‹å·¥åœ¨ LogRecord çš„æ³¨è§£ä¸ŠæŒ‡å®šã€‚è¿™ç§éœ€è¦æ–¹æ³•å‚æ•°ä¸Šæœ‰ operator",-1),q=n("div",{class:"language-java line-numbers-mode","data-ext":"java"},[n("pre",{java:"",class:"language-java"},[n("code",null,[n("span",{class:"token comment"},"// éœ€è¦æ–¹æ³•å‚æ•°ä¸Šæœ‰ operator å‚æ•°ï¼Œæˆ–è€…é€šè¿‡ SpEL è°ƒç”¨é™æ€æ–¹æ³•è·å–å½“å‰ç”¨æˆ·ã€‚"),s(`
`),n("span",{class:"token annotation punctuation"},"@LogRecordAnnotation"),n("span",{class:"token punctuation"},"("),s(`
    fail `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"åˆ›å»ºè®¢å•å¤±è´¥ï¼Œå¤±è´¥åŸå› ï¼šã€Œ{{#_errorMsg}}ã€"'),n("span",{class:"token punctuation"},","),s(`
    category `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"MANAGER_VIEW"'),n("span",{class:"token punctuation"},","),s(`
    detail `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.toString()}}"'),n("span",{class:"token punctuation"},","),s(`
    operator `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#currentUser}}"'),n("span",{class:"token punctuation"},","),s(`
    success `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.purchaseName}}ä¸‹äº†ä¸€ä¸ªè®¢å•,è´­ä¹°å•†å“ã€Œ{{#order.productName}}ã€,ä¸‹å•ç»“æœ:{{#_ret}}"'),n("span",{class:"token punctuation"},","),s(`
    prefix `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token class-name"},"LogRecordType"),n("span",{class:"token punctuation"},"."),n("span",{class:"token constant"},"ORDER"),n("span",{class:"token punctuation"},","),s(`
    bizNo `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"{{#order.orderNo}}"'),s(`
`),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token keyword"},"public"),s(),n("span",{class:"token keyword"},"boolean"),s(),n("span",{class:"token function"},"createOrder"),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},"Order"),s(" order"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token class-name"},"String"),s(" currentUser"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token punctuation"},"{"),s(`
    log`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"info"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"ã€åˆ›å»ºè®¢å•ã€‘orderNo={}"'),n("span",{class:"token punctuation"},","),s(" order"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"getOrderNo"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token comment"},"// db insert order"),s(`
    `),n("span",{class:"token keyword"},"return"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"},"Â "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),x=o(`<p>ç¬¬äºŒç§ï¼šé€šè¿‡é»˜è®¤å®ç°ç±»æ¥è‡ªåŠ¨çš„è·å–æ“ä½œäººï¼Œç”±äºåœ¨å¤§éƒ¨åˆ† web åº”ç”¨ä¸­å½“å‰çš„ç”¨æˆ·éƒ½æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„ï¼Œæ‰€ä»¥æ¯ä¸ªæ³¨è§£éƒ½åŠ ä¸€ä¸ª operator è·å–æ“ä½œäººæ˜¾å¾—æœ‰äº›é‡å¤åŠ³åŠ¨ï¼Œæ‰€ä»¥æä¾›äº†ä¸€ä¸ªæ‰©å±•æ¥å£æ¥è·å–æ“ä½œäºº æ¡†æ¶æä¾›äº†ä¸€ä¸ªæ‰©å±•æ¥å£ï¼Œä½¿ç”¨æ¡†æ¶çš„ä¸šåŠ¡å¯ä»¥ implements è¿™ä¸ªæ¥å£è‡ªå·±å®ç°è·å–å½“å‰ç”¨æˆ·çš„é€»è¾‘ï¼Œ å¯¹äºä½¿ç”¨ Springboot çš„åªéœ€è¦å®ç° IOperatorGetService æ¥å£ï¼Œç„¶åæŠŠè¿™ä¸ª Service ä½œä¸ºä¸€ä¸ªå•ä¾‹æ”¾åˆ° Spring çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ä½¿ç”¨ Spring Mvc çš„å°±éœ€è¦è‡ªå·±æ‰‹å·¥è£…é…è¿™äº› bean äº†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogRecordConfiguration</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">IOperatorGetService</span> <span class="token function">operatorGetService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">OrgUserUtils</span><span class="token punctuation">.</span><span class="token function">getCurrentUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>a <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">OperatorDO</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getMisId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;user is null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//ä¹Ÿå¯ä»¥è¿™ä¹ˆæï¼š</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultOperatorGetServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IOperatorGetService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">OperatorDO</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">OperatorDO</span> operatorDO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OperatorDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        operatorDO<span class="token punctuation">.</span><span class="token function">setOperatorId</span><span class="token punctuation">(</span><span class="token string">&quot;SYSTEM&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> operatorDO<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´" tabindex="-1"><a class="header-anchor" href="#_6-æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´" aria-hidden="true">#</a> 6. æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">/*
å¯¹äºæ›´æ–°ç­‰æ–¹æ³•ï¼Œæ–¹æ³•çš„å‚æ•°ä¸Šå¤§éƒ¨åˆ†éƒ½æ˜¯è®¢å•IDã€æˆ–è€…äº§å“IDç­‰ï¼Œ æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼šæ—¥å¿—è®°å½•çš„successå†…å®¹æ˜¯ï¼šâ€œæ›´æ–°äº†è®¢å•{{#orderId}},æ›´æ–°å†…å®¹ä¸ºâ€¦â€ï¼Œè¿™ç§å¯¹äºè¿è¥æˆ–è€…äº§å“æ¥è¯´éš¾ä»¥ç†è§£ï¼Œæ‰€ä»¥å¼•å…¥äº†è‡ªå®šä¹‰å‡½æ•°çš„åŠŸèƒ½ã€‚ä½¿ç”¨æ–¹æ³•æ˜¯åœ¨åŸæ¥çš„å˜é‡çš„ä¸¤ä¸ªå¤§æ‹¬å·ä¹‹é—´åŠ ä¸€ä¸ªå‡½æ•°åç§° ä¾‹å¦‚ â€œ{ORDER{#orderId}}â€ å…¶ä¸­ ORDER æ˜¯ä¸€ä¸ªå‡½æ•°åç§°ã€‚åªæœ‰ä¸€ä¸ªå‡½æ•°åç§°æ˜¯ä¸å¤Ÿçš„,éœ€è¦æ·»åŠ è¿™ä¸ªå‡½æ•°çš„å®šä¹‰å’Œå®ç°ã€‚å¯ä»¥çœ‹ä¸‹é¢ä¾‹å­ è‡ªå®šä¹‰çš„å‡½æ•°éœ€è¦å®ç°æ¡†æ¶é‡Œé¢çš„IParseFunctionçš„æ¥å£ï¼Œéœ€è¦å®ç°ä¸¤ä¸ªæ–¹æ³•ï¼š
functionName() æ–¹æ³•å°±è¿”å›æ³¨è§£ä¸Šé¢çš„å‡½æ•°åï¼›
apply()å‡½æ•°å‚æ•°æ˜¯ &quot;{ORDER{#orderId}}&quot;ä¸­SpELè§£æçš„#orderIdçš„å€¼ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæ•°å­—1223110ï¼Œæ¥ä¸‹æ¥åªéœ€è¦åœ¨å®ç°çš„ç±»ä¸­æŠŠ ID è½¬æ¢ä¸ºå¯è¯»æ‡‚çš„å­—ç¬¦ä¸²å°±å¯ä»¥äº†ï¼Œ ä¸€èˆ¬ä¸ºäº†æ–¹ä¾¿æ’æŸ¥é—®é¢˜éœ€è¦æŠŠåç§°å’ŒIDéƒ½å±•ç¤ºå‡ºæ¥ï¼Œä¾‹å¦‚ï¼š&quot;è®¢å•åç§°ï¼ˆIDï¼‰&quot;çš„å½¢å¼ã€‚
è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼šåŠ äº†è‡ªå®šä¹‰å‡½æ•°åï¼Œæ¡†æ¶æ€ä¹ˆèƒ½è°ƒç”¨åˆ°å‘¢ï¼Ÿç­”ï¼šå¯¹äºSpring bootåº”ç”¨å¾ˆç®€å•ï¼Œåªéœ€è¦æŠŠå®ƒæš´éœ²åœ¨Springçš„ä¸Šä¸‹æ–‡ä¸­å°±å¯ä»¥äº†ï¼Œå¯ä»¥åŠ ä¸ŠSpringçš„ @Component æˆ–è€… @Service å¾ˆæ–¹ä¾¿ğŸ˜„ã€‚Spring mvc åº”ç”¨éœ€è¦è‡ªå·±è£…é… Beanã€‚
*/</span>
<span class="token comment">// æ²¡æœ‰ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°</span>
<span class="token annotation punctuation">@LogRecordAnnotation</span><span class="token punctuation">(</span>
    success <span class="token operator">=</span> <span class="token string">&quot;æ›´æ–°äº†è®¢å•{{#orderId}},æ›´æ–°å†…å®¹ä¸º....&quot;</span><span class="token punctuation">,</span>
    prefix <span class="token operator">=</span> <span class="token class-name">LogRecordType</span><span class="token punctuation">.</span><span class="token constant">ORDER</span><span class="token punctuation">,</span>
    bizNo <span class="token operator">=</span> <span class="token string">&quot;{{#order.orderNo}}&quot;</span><span class="token punctuation">,</span>
    detail <span class="token operator">=</span> <span class="token string">&quot;{{#order.toString()}}&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Long</span> orderId<span class="token punctuation">,</span> <span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//ä½¿ç”¨äº†è‡ªå®šä¹‰å‡½æ•°ï¼Œä¸»è¦æ˜¯åœ¨ {{#orderId}} çš„å¤§æ‹¬å·ä¸­é—´åŠ äº† functionName</span>
<span class="token annotation punctuation">@LogRecordAnnotation</span><span class="token punctuation">(</span>
    success <span class="token operator">=</span> <span class="token string">&quot;æ›´æ–°äº†è®¢å•ORDER{#orderId}},æ›´æ–°å†…å®¹ä¸º...&quot;</span><span class="token punctuation">,</span>
    prefix <span class="token operator">=</span> <span class="token class-name">LogRecordType</span><span class="token punctuation">.</span><span class="token constant">ORDER</span><span class="token punctuation">,</span>
    bizNo <span class="token operator">=</span> <span class="token string">&quot;{{#order.orderNo}}&quot;</span><span class="token punctuation">,</span>
    detail <span class="token operator">=</span> <span class="token string">&quot;{{#order.toString()}}&quot;</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Long</span> orderId<span class="token punctuation">,</span> <span class="token class-name">Order</span> order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// è¿˜éœ€è¦åŠ ä¸Šå‡½æ•°çš„å®ç°</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderParseFunction</span> <span class="token keyword">implements</span> <span class="token class-name">IParseFunction</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token annotation punctuation">@Lazy</span> <span class="token comment">//ä¸ºäº†é¿å…ç±»åŠ è½½é¡ºåºçš„é—®é¢˜ æœ€å¥½ä¸ºLazyï¼Œæ²¡æœ‰é—®é¢˜ä¹Ÿå¯ä»¥ä¸åŠ </span>
    <span class="token keyword">private</span> <span class="token class-name">OrderQueryService</span> orderQueryService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">functionName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//  å‡½æ•°åç§°ä¸º ORDER</span>
        <span class="token keyword">return</span> <span class="token string">&quot;ORDER&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token comment">//è¿™é‡Œçš„ value å¯ä»¥å§ Order çš„JSONå¯¹è±¡çš„ä¼ é€’è¿‡æ¥ï¼Œç„¶ååè§£ææ‹¼æ¥ä¸€ä¸ªå®šåˆ¶çš„æ“ä½œæ—¥å¿—å†…å®¹</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Order</span> order <span class="token operator">=</span> orderQueryService<span class="token punctuation">.</span><span class="token function">queryOrder</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æŠŠè®¢å•äº§å“åç§°åŠ ä¸Šä¾¿äºç†è§£ï¼ŒåŠ ä¸Š ID ä¾¿äºæŸ¥é—®é¢˜</span>
        <span class="token keyword">return</span> order<span class="token punctuation">.</span><span class="token function">getProductName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">&quot;(&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´-ä½¿ç”¨-spel-ä¸‰ç›®è¡¨è¾¾å¼" tabindex="-1"><a class="header-anchor" href="#_7-æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´-ä½¿ç”¨-spel-ä¸‰ç›®è¡¨è¾¾å¼" aria-hidden="true">#</a> 7. æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´ ä½¿ç”¨ SpEL ä¸‰ç›®è¡¨è¾¾å¼</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@LogRecordAnnotation</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token class-name">LogRecordTypeConstant</span><span class="token punctuation">.</span><span class="token constant">CUSTOM_ATTRIBUTE</span><span class="token punctuation">,</span> bizNo <span class="token operator">=</span> <span class="token string">&quot;{{#businessLineId}}&quot;</span><span class="token punctuation">,</span> success <span class="token operator">=</span> <span class="token string">&quot;{{#disable ? &#39;åœç”¨&#39; : &#39;å¯ç”¨&#39;}}äº†è‡ªå®šä¹‰å±æ€§{ATTRIBUTE{#attributeId}}&quot;</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token class-name">CustomAttributeVO</span> <span class="token function">disableAttribute</span><span class="token punctuation">(</span><span class="token class-name">Long</span> businessLineId<span class="token punctuation">,</span> <span class="token class-name">Long</span> attributeId<span class="token punctuation">,</span> <span class="token keyword">boolean</span> disable<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> xxx<span class="token punctuation">;</span> <span class="token punctuation">}</span> \`
æ¡†æ¶çš„æ‰©å±•ç‚¹ï¼Œé‡å†™ <span class="token class-name">OperatorGetServiceImpl</span> é€šè¿‡ä¸Šä¸‹æ–‡è·å–ç”¨æˆ·çš„æ‰©å±•ï¼Œä¾‹å­å¦‚ä¸‹
\`\`\` java
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultOperatorGetServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IOperatorGetService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Operator</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token class-name">UserUtils</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>a <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Operator</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token function">getLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;user is null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ILogRecordService ä¿å­˜/æŸ¥è¯¢æ—¥å¿—çš„ä¾‹å­,ä½¿ç”¨è€…å¯ä»¥æ ¹æ®æ•°æ®é‡ä¿å­˜åˆ°åˆé€‚çš„å­˜å‚¨ä»‹è´¨ä¸Šï¼Œæ¯”å¦‚ä¿å­˜åœ¨æ•°æ®åº“/æˆ–è€… ESã€‚è‡ªå·±å®ç°ä¿å­˜å’Œåˆ é™¤å°±å¯ä»¥äº†</p><p>ä¹Ÿå¯ä»¥åªå®ç°æŸ¥è¯¢çš„æ¥å£ï¼Œæ¯•ç«Ÿå·²ç»ä¿å­˜åœ¨ä¸šåŠ¡çš„å­˜å‚¨ä¸Šäº†ï¼ŒæŸ¥è¯¢ä¸šåŠ¡å¯ä»¥è‡ªå·±å®ç°ï¼Œä¸èµ° ILogRecordService è¿™ä¸ªæ¥å£ï¼Œæ¯•ç«Ÿäº§å“ç»ç†ä¼šæä¸€äº›åƒå¥‡ç™¾æ€ªçš„æŸ¥è¯¢éœ€æ±‚ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DbLogRecordServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ILogRecordService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">LogRecordMapper</span> logRecordMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span>propagation <span class="token operator">=</span> <span class="token class-name">Propagation</span><span class="token punctuation">.</span><span class="token constant">REQUIRES_NEW</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">record</span><span class="token punctuation">(</span><span class="token class-name">LogRecord</span> logRecord<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ã€logRecordã€‘log={}&quot;</span><span class="token punctuation">,</span> logRecord<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">LogRecordPO</span> logRecordPO <span class="token operator">=</span> <span class="token class-name">LogRecordPO</span><span class="token punctuation">.</span><span class="token function">toPo</span><span class="token punctuation">(</span>logRecord<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logRecordMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>logRecordPO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogRecord</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryLog</span><span class="token punctuation">(</span><span class="token class-name">String</span> bizKey<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> types<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">PageDO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LogRecord</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryLogByBizNo</span><span class="token punctuation">(</span><span class="token class-name">String</span> bizNo<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> types<span class="token punctuation">,</span> <span class="token class-name">PageRequestDO</span> pageRequestDO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> logRecordMapper<span class="token punctuation">.</span><span class="token function">selectByBizNoAndCategory</span><span class="token punctuation">(</span>bizNo<span class="token punctuation">,</span> types<span class="token punctuation">,</span> pageRequestDO<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>IParseFunction è‡ªå®šä¹‰è½¬æ¢å‡½æ•°çš„æ¥å£ï¼Œå¯ä»¥å®ç° IParseFunction å®ç°å¯¹ LogRecord æ³¨è§£ä¸­ä½¿ç”¨çš„å‡½æ•°æ‰©å±• ä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserParseFunction</span> <span class="token keyword">implements</span> <span class="token class-name">IParseFunction</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Splitter</span> splitter <span class="token operator">=</span> <span class="token class-name">Splitter</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trimResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token annotation punctuation">@Lazy</span>
    <span class="token keyword">private</span> <span class="token class-name">UserQueryService</span> userQueryService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">functionName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;USER&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token comment">// 11,12 è¿”å› 11(å°æ˜)ï¼Œ12(å¼ ä¸‰)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> userIds <span class="token operator">=</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">newArrayList</span><span class="token punctuation">(</span>splitter<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> misDOList <span class="token operator">=</span> userQueryService<span class="token punctuation">.</span><span class="token function">getUserList</span><span class="token punctuation">(</span>userIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userMap <span class="token operator">=</span> <span class="token class-name">StreamUtil</span><span class="token punctuation">.</span><span class="token function">extractMap</span><span class="token punctuation">(</span>misDOList<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> userId <span class="token operator">:</span> userIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>userMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;(&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>userMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">&quot;,$&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11);function E(D,j){const c=p("ExternalLinkIcon"),t=p("router-link");return i(),u("div",null,[n("blockquote",null,[d,v,n("p",null,[s("githubåœ°å€ï¼š"),n("a",m,[s("https://github.com/mouzt/mzt-biz-log"),a(c)])])]),r(" more "),n("nav",b,[n("ul",null,[n("li",null,[a(t,{to:"#maven-ä¾èµ–æ·»åŠ -sdk-ä¾èµ–"},{default:e(()=>[s("maven ä¾èµ–æ·»åŠ  SDK ä¾èµ–")]),_:1})]),n("li",null,[a(t,{to:"#æ·»åŠ -enablelogrecord-æ³¨è§£"},{default:e(()=>[s("æ·»åŠ  @EnableLogRecord æ³¨è§£")]),_:1})]),n("li",null,[a(t,{to:"#æ—¥å¿—åŸ‹ç‚¹"},{default:e(()=>[s("æ—¥å¿—åŸ‹ç‚¹")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#_1-æ™®é€šçš„è®°å½•æ—¥å¿—"},{default:e(()=>[s("1. æ™®é€šçš„è®°å½•æ—¥å¿—")]),_:1})]),n("li",null,[a(t,{to:"#_2-æœŸæœ›è®°å½•å¤±è´¥çš„æ—¥å¿—-å¦‚æœæŠ›å‡ºå¼‚å¸¸åˆ™è®°å½•-fail-çš„æ—¥å¿—-æ²¡æœ‰æŠ›å‡ºè®°å½•-success-çš„æ—¥å¿—"},{default:e(()=>[s("2. æœŸæœ›è®°å½•å¤±è´¥çš„æ—¥å¿—, å¦‚æœæŠ›å‡ºå¼‚å¸¸åˆ™è®°å½• fail çš„æ—¥å¿—ï¼Œæ²¡æœ‰æŠ›å‡ºè®°å½• success çš„æ—¥å¿—")]),_:1})]),n("li",null,[a(t,{to:"#_3-æ—¥å¿—æ”¯æŒç§ç±»"},{default:e(()=>[s("3. æ—¥å¿—æ”¯æŒç§ç±»")]),_:1})]),n("li",null,[a(t,{to:"#_4-æ”¯æŒè®°å½•æ“ä½œçš„è¯¦æƒ…æˆ–è€…é¢å¤–ä¿¡æ¯"},{default:e(()=>[s("4. æ”¯æŒè®°å½•æ“ä½œçš„è¯¦æƒ…æˆ–è€…é¢å¤–ä¿¡æ¯")]),_:1})]),n("li",null,[a(t,{to:"#_5-å¦‚ä½•æŒ‡å®šæ“ä½œæ—¥å¿—çš„æ“ä½œäººæ˜¯ä»€ä¹ˆ-æ¡†æ¶æä¾›äº†ä¸¤ç§æ–¹æ³•"},{default:e(()=>[s("5. å¦‚ä½•æŒ‡å®šæ“ä½œæ—¥å¿—çš„æ“ä½œäººæ˜¯ä»€ä¹ˆï¼Ÿæ¡†æ¶æä¾›äº†ä¸¤ç§æ–¹æ³•")]),_:1})]),n("li",null,[a(t,{to:"#_6-æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´"},{default:e(()=>[s("6. æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´")]),_:1})]),n("li",null,[a(t,{to:"#_7-æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´-ä½¿ç”¨-spel-ä¸‰ç›®è¡¨è¾¾å¼"},{default:e(()=>[s("7. æ—¥å¿—æ–‡æ¡ˆè°ƒæ•´ ä½¿ç”¨ SpEL ä¸‰ç›®è¡¨è¾¾å¼")]),_:1})])])])])]),g,f,h,y,_,w,R,O,S,I,L,N,q,x])}const M=l(k,[["render",E],["__file","13.springboot_bizlogæ—¥å¿—.html.vue"]]);export{M as default};
